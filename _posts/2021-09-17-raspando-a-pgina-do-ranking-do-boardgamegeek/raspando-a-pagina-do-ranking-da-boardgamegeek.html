<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { color: #585cf6; } /* Constant */
code span.co { color: #4c886b; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.dv { color: #0000cd; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cd; } /* Float */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { color: #687687; } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #036a07; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>Raspando a página do ranking do BoardGameGeek</title>

  <meta property="description" itemprop="description" content="Neste post eu faço a raspagem da tabela do ranking dos jogos de tabuleiro do BoardGameGeek. Essa tarefa foi necessária para que eu conseguisse interagir da melhor forma possível com a API XML que o site oferece."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2021-09-17"/>
  <meta property="article:created" itemprop="dateCreated" content="2021-09-17"/>
  <meta name="article:author" content="Nicholas Marino"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Raspando a página do ranking do BoardGameGeek"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Neste post eu faço a raspagem da tabela do ranking dos jogos de tabuleiro do BoardGameGeek. Essa tarefa foi necessária para que eu conseguisse interagir da melhor forma possível com a API XML que o site oferece."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Raspando a página do ranking do BoardGameGeek"/>
  <meta property="twitter:description" content="Neste post eu faço a raspagem da tabela do ranking dos jogos de tabuleiro do BoardGameGeek. Essa tarefa foi necessária para que eu conseguisse interagir da melhor forma possível com a API XML que o site oferece."/>

  <!--/radix_placeholder_meta_tags-->
  
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","bibliography","categories","output","draft"]}},"value":[{"type":"character","attributes":{},"value":["Raspando a página do ranking do BoardGameGeek"]},{"type":"character","attributes":{},"value":["Neste post eu faço a raspagem da tabela do ranking dos jogos de tabuleiro do BoardGameGeek. Essa tarefa foi necessária para que eu conseguisse interagir da melhor forma possível com a API XML que o site oferece.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["first_name","last_name","url"]}},"value":[{"type":"character","attributes":{},"value":["Nicholas"]},{"type":"character","attributes":{},"value":["Marino"]},{"type":"character","attributes":{},"value":["https://github.com/nacmarino"]}]}]},{"type":"character","attributes":{},"value":["09-17-2021"]},{"type":"character","attributes":{},"value":["bibliografia.bib"]},{"type":"character","attributes":{},"value":["web scraping","boardgames"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","code_folding","highlight"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["rstudio"]}]}]},{"type":"logical","attributes":{},"value":[false]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["bibliografia.bib","data/page_1.html","data/page_2.html","data/page_3.html","data/page_4.html","data/page_5.html","images/identificar_1.jpg","images/identificar_2.jpg","images/navegar_1.jpg","images/parsear_1.jpg","images/web_scarapping_cycle_curso_r.png","raspando-a-pagina-do-ranking-da-boardgamegeek_files/anchor-4.2.2/anchor.min.js","raspando-a-pagina-do-ranking-da-boardgamegeek_files/bowser-1.9.3/bowser.min.js","raspando-a-pagina-do-ranking-da-boardgamegeek_files/distill-2.2.21/template.v2.js","raspando-a-pagina-do-ranking-da-boardgamegeek_files/figure-html5/figura_exploratoria-1.png","raspando-a-pagina-do-ranking-da-boardgamegeek_files/header-attrs-2.10/header-attrs.js","raspando-a-pagina-do-ranking-da-boardgamegeek_files/jquery-1.11.3/jquery.min.js","raspando-a-pagina-do-ranking-da-boardgamegeek_files/popper-2.6.0/popper.min.js","raspando-a-pagina-do-ranking-da-boardgamegeek_files/tippy-6.2.7/tippy-bundle.umd.min.js","raspando-a-pagina-do-ranking-da-boardgamegeek_files/tippy-6.2.7/tippy-light-border.css","raspando-a-pagina-do-ranking-da-boardgamegeek_files/tippy-6.2.7/tippy.css","raspando-a-pagina-do-ranking-da-boardgamegeek_files/tippy-6.2.7/tippy.umd.min.js","raspando-a-pagina-do-ranking-da-boardgamegeek_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="raspando-a-pagina-do-ranking-da-boardgamegeek_files/header-attrs-2.10/header-attrs.js"></script>
  <script src="raspando-a-pagina-do-ranking-da-boardgamegeek_files/jquery-1.11.3/jquery.min.js"></script>
  <script src="raspando-a-pagina-do-ranking-da-boardgamegeek_files/popper-2.6.0/popper.min.js"></script>
  <link href="raspando-a-pagina-do-ranking-da-boardgamegeek_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="raspando-a-pagina-do-ranking-da-boardgamegeek_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="raspando-a-pagina-do-ranking-da-boardgamegeek_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="raspando-a-pagina-do-ranking-da-boardgamegeek_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="raspando-a-pagina-do-ranking-da-boardgamegeek_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="raspando-a-pagina-do-ranking-da-boardgamegeek_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="raspando-a-pagina-do-ranking-da-boardgamegeek_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Raspando a página do ranking do BoardGameGeek","description":"Neste post eu faço a raspagem da tabela do ranking dos jogos de tabuleiro do BoardGameGeek. Essa tarefa foi necessária para que eu conseguisse interagir da melhor forma possível com a API XML que o site oferece.","authors":[{"author":"Nicholas Marino","authorURL":"https://github.com/nacmarino","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-09-17T00:00:00.000+00:00","citationText":"Marino, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Raspando a página do ranking do BoardGameGeek</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt=tag">web scraping</div>
<div class="dt=tag">boardgames</div>
</div>
<!--/radix_placeholder_categories-->
<p><p>Neste post eu faço a raspagem da tabela do ranking dos jogos de tabuleiro do BoardGameGeek. Essa tarefa foi necessária para que eu conseguisse interagir da melhor forma possível com a API XML que o site oferece.</p></p>
</div>

<div class="d-byline">
  
  true
  
<br/>09-17-2021
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#motivação">Motivação</a></li>
<li><a href="#identificar">Identificar</a></li>
<li><a href="#navegar">Navegar</a></li>
<li><a href="#replicar">Replicar</a></li>
<li><a href="#parsear">Parsear</a></li>
<li><a href="#validar">Validar</a></li>
<li><a href="#iterar">Iterar</a></li>
<li><a href="#faxinar-não-incluído-mas-importante">Faxinar (não incluído, mas importante)</a></li>
<li><a href="#conclusões">Conclusões</a></li>
</ul>
</nav>
</div>
<h1 id="motivação">Motivação</h1>
<p>Sempre joguei os jogos de tabuleiro mais tradicionais, como Banco Imobiliário, Scotland Yard e War. Esses são jogos muito populares, apesar de cada partida ser muito repetitiva e eles demandarem uma quantidade razoável de jogadores para que tenham graça - e, no meio de uma pandemia, se já acabava sendo chato jogar um deles, a coisa passou a ser impossível. Mas será que não existem alternativas (mais divertidas, inclusive) para continuar com a distração num momento tão difícil como esse? Como eu bem descobri, a resposta estava nos próprios jogos de tabuleiro - mais precisamente, na reinvenção que eles sofreram nas últimas décadas.</p>
<p>Existem inúmeros jogos de tabuleiro disponíveis atualmente e um número crescente de pessoas que os curtem. Dada esta diversidade de novos títulos, inúmeros portais têm focado em criar e manter essa cultura, trazendo reportagens, fóruns, <em>marketplaces</em>, <em>reviews</em>, rankings e fichas técnicas de cada um deles. Dois exemplos destes sites são o <a href="https://boardgamegeek.com/">BoardGameGeek</a> e a <a href="https://www.ludopedia.com.br/">Ludopedia</a>: ambos possuem praticamente o mesmo conteúdo, mas o primeiro é um portal americano e o segundo é brasileiro. Outro ponto interessante é que o consumo de informações desses portais não precisa ocorrer pelo <em>browser</em>, uma vez que ambos fornecem uma API. A Ludopedia oferece uma API REST bastante intuitiva<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, enquanto o BoardGameGeek usa uma API XML que eu acabei achando meio complicada de usar. Mas o que isto tudo tem haver com dados?</p>
<p>Bom, logo que descobri esse <em>hobby</em>, acabei ficando muito perdido sobre quais são os títulos mais legais para se jogar. São tantas as possibilidades e informações disponíveis sobre cada jogo, que eu me peguei navegando entre inúmeras páginas naqueles portais para tentar encontrar aquilo que eu estava buscando. Assim, acabei tendo a ideia de compilar essas informações e colocar tudo dentro de uma linguagem de programação, a fim de deixar a análise de dados me ajudar a encontrar os jogos que mais combinavam com aquilo que eu estava buscando. Para isso, tive a ideia de pegar as informações dos jogos do BoardGameGeek (BGG daqui em diante) através de sua API, tabular tudo o que estava buscando e partir para o abraço. Mas nada é tão simples quanto parece.</p>
<p>A parede que encontrei é bem chatinha: o <em>request</em> da API XML do BoardGameGeek funciona muito melhor quando usamos o código numérico de identificação do jogo. Quando passamos o nome do jogo para o <em>request</em>, ele precisa estar grafado igual à como está na base do BGG, caso contrário ele pode falhar em trazer o que você está buscando ou trazer todos os títulos que tenham um <em>match</em> parcial com aquele que você buscou (daí para a frente é só caos). Outra ressalva aqui é que essa API não oferece nenhum tipo de método através do qual podemos pegar um de-para dos IDs numéricos para os nomes dos jogos, e o código numérico deles também não é sequencial. Logo, não dá para fazer uma busca gulosa e <em>loopar</em> os IDs de 1 até <em>n</em>. A solução mais simples para o problema é montar a nossa própria base de-para, catando o nome dos títulos e o seu ID numérico de algum lugar do site do BGG - e esse lugar é a página que contém o ranking dos jogos de tabuleiro no site.</p>
<p>Neste <em>post</em> eu vou mostrar como raspar a página do ranking do BGG, usando como base o fluxo do Web Scrapping que a galera da Curso-R criou (<span class="citation" data-cites="Lente2018"><a href="#ref-Lente2018" role="doc-biblioref">Lente</a> (<a href="#ref-Lente2018" role="doc-biblioref">2018</a>)</span>), e muito bem ilustrada na figura abaixo.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/include_graphics.html'>include_graphics</a></span><span class='op'>(</span>path <span class='op'>=</span> <span class='st'>'images/web_scarapping_cycle_curso_r.png'</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-1"></span>
<img src="images/web_scarapping_cycle_curso_r.png" alt="Fluxo do Web Scrapping de acordo com o Lente (2018). Figura copiada de https://blog.curso-r.com/posts/2018-02-18-fluxo-scraping/." width="874" />
<p class="caption">
Figure 1: Fluxo do Web Scrapping de acordo com o Lente (2018). Figura copiada de <a href="https://blog.curso-r.com/posts/2018-02-18-fluxo-scraping/" class="uri">https://blog.curso-r.com/posts/2018-02-18-fluxo-scraping/</a>.
</p>
</div>
</div>
<h1 id="identificar">Identificar</h1>
<p>A primeira coisa a se fazer é entender como funciona a página que queremos raspar e o seu fluxo de paginação - isto é, como fazer para navegar de uma página para a outra. No nosso caso, navegamos até a página inicial do ranking do BGG através do link <code>https://boardgamegeek.com/browse/boardgame</code>; isso deve nos levar à uma página similar à da figura abaixo.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/include_graphics.html'>include_graphics</a></span><span class='op'>(</span>path <span class='op'>=</span> <span class='st'>'images/identificar_1.jpg'</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="images/identificar_1.jpg" width="1668" style="display: block; margin: auto;" /></p>
</div>
<p>Podemos ver que a página que contém o Top 100 dos jogos de tabuleiro apresenta as informações do ranking dentro de uma tabela: cada jogo no ranking ocupa uma linha da tabela, e cada coluna abriga uma informação distinta sobre o título que ocupa àquela posição (<em>i.e.</em>, ranking, título, uma pequena descrição, quantidade de votos, notas,…). Além disso, podemos ver que o ranking é composto por dezenas de páginas, e podemos navegar através delas pela paginação acima ou abaixo da tabela.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/include_graphics.html'>include_graphics</a></span><span class='op'>(</span>path <span class='op'>=</span> <span class='st'>'images/identificar_2.jpg'</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="images/identificar_2.jpg" width="1676" style="display: block; margin: auto;" /></p>
</div>
<p>Ao passarmos para a segunda página, podemos ver que agora temos acesso às informações do Top 101 ao 200 dos jogos de tabuleiro. Assim, dá para entender que cada página deve conter uma tabelinha com 100 linhas, uma para cada título ocupando cada uma das posições. Outro ponto importante é que quando mudamos para a segunda página do ranking, houve a adição do sufixo <code>page/2</code> à <em>url</em>. Se brincarmos um pouquinho com essa <em>url</em> podemos ver que é possível navegar entre as páginas simplesmente mudando o número ao final da url: <code>https://boardgamegeek.com/browse/boardgame/page/1</code>, <code>https://boardgamegeek.com/browse/boardgame/page/2</code>, <code>https://boardgamegeek.com/browse/boardgame/page/3</code> e assim por diante. Ou seja, para raspar as páginas do ranking basta usarmos a <em>url</em> base (<code>https://boardgamegeek.com/browse/boardgame/page/</code>) e variar apenas a numeração ali no fim.</p>
<h1 id="navegar">Navegar</h1>
<p>Uma vez que entendemos de que forma funcionam as páginas que queremos raspar, precisamos agora é entender de onde vem o dado que queremos extrair através do código da página. De forma bem geral, podemos usar as ferramentas do desenvolvedor do nosso navegar e ir até a aba de <em>Network</em> para ver se a página está fazendo alguma chamada à uma API para carregar o seu conteúdo - se esse for o caso, podemos aprender a usar a API e usar ela para obter os dados que buscamos. Caso não haja uma API por trás da informação que estamos buscando, podemos ir direto na aba <em>Elements</em> e olhar o código HTML para entender como o que estamos buscando está estruturado.</p>
<p>No nosso caso, não consegui achar uma API alimentando os dados da tabela que queremos raspar - aparentemente, todo o dado é carregando junto do HTML da página. Assim, olhando o código HTML da página, dá para ver que a tabela que buscamos está dentro de uma tag <em>table</em>. Portanto, se conseguirmos pegar o HTML da página, teremos acesso aos dados que estamos buscando.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/include_graphics.html'>include_graphics</a></span><span class='op'>(</span>path <span class='op'>=</span> <span class='st'>'images/navegar_1.jpg'</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="images/navegar_1.jpg" width="1677" style="display: block; margin: auto;" /></p>
</div>
<h1 id="replicar">Replicar</h1>
<p>Como sabemos a <em>url</em> base e como navegar entre as páginas, a ideia será tentar pegar uma das páginas e ver se temos sucesso na tarefa. Vamos então para o R. Primeiro vou carregar alguns pacotes para nos ajudar a fazer o web scrapping, manipular os dados e algumas coisas mais. Vou então criar um objeto que vai receber a <em>url</em> base do ranking do BGG e mais um objeto com a numeração da página do ranking que vamos tentar pegar na primeira tentativa.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span> <span class='co'># core</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://httr.r-lib.org/'>httr</a></span><span class='op'>)</span> <span class='co'># web scrapping</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://xml2.r-lib.org/'>xml2</a></span><span class='op'>)</span> <span class='co'># parsear</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://fs.r-lib.org'>fs</a></span><span class='op'>)</span> <span class='co'># mexer com paths</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggforce.data-imaginist.com'>ggforce</a></span><span class='op'>)</span> <span class='co'># extendendo o ggplot2</span>

<span class='co'>## para raspar o site</span>
<span class='va'>base_url</span> <span class='op'>&lt;-</span> <span class='st'>'https://boardgamegeek.com/browse/boardgame/page/'</span>

<span class='co'># definindo qual pagina vamos raspar</span>
<span class='va'>pagina_alvo</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
</code></pre>
</div>
</div>
<p>Com estes pacotes e objetos definindos, vou utilizar então a função <code>GET</code> do pacote <code>httr</code> para fazer o <em>request</em> da página. Vou passar o endereço da página para a função e, também, escrever o resultado do <em>request</em> para o disco passando uma outra função (<code>write_disk</code>) para o <code>GET</code>. O benefício disso são pelo menos dois: (1) podemos manter uma memória exata do que foi raspado naquele dia e (2) usar o dado raspado <em>offline</em>, sem a necessidade de ter que ficar bombardeando o site o tempo todo de <em>resquests</em>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## passando o get e salvando o arquivo html</span>
<span class='va'>resultado</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://httr.r-lib.org/reference/GET.html'>GET</a></span><span class='op'>(</span>url <span class='op'>=</span> <span class='fu'>str_glue</span><span class='op'>(</span><span class='va'>base_url</span>, <span class='va'>pagina_alvo</span><span class='op'>)</span>, 
                 <span class='fu'><a href='https://httr.r-lib.org/reference/write_disk.html'>write_disk</a></span><span class='op'>(</span>path <span class='op'>=</span> <span class='fu'>str_glue</span><span class='op'>(</span><span class='st'>'data/page_{pagina_alvo}.html'</span><span class='op'>)</span>, 
                            overwrite <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Uma vez que o <em>request</em> foi feito, podemos ver o objeto resultante. É possível ver que tivemos sucesso em nossa requisição através do status 200, e também podemos ver que o conteúdo obtido é um documento HTML (conforme esperado). Beleza, temos o conteúdo; agora precisamos extrair os dados a partir dele.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='st'>'Status code: %.0d'</span>, <span class='va'>resultado</span><span class='op'>$</span><span class='va'>status_code</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] &quot;Status code: 200&quot;</code></pre>
</div>
<h1 id="parsear">Parsear</h1>
<p>O que estamos buscando está dentro de uma tabela no código HTML, conforme havíamos visto anteriormente. Podemos tomar vantagem disto e buscar a <em>tag</em> <em>table</em> dentro do código HTML através do respectivo XPath utilizando a função <code>xml_find_all</code>. Com este resultado, podemos então utilizar a função <code>html_table</code> do pacote <code>rvest</code>, que é muito útil em casos como esse: ela é capaz de converter a tabela HTML diretamente para uma <code>tibble</code>. Como o resultado desse processo é uma <code>tibble</code> como o primeiro elemento de uma lista, vou usar a função <code>pluck</code> para extrair este objeto.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## parseando o html para um tibble</span>
<span class='va'>ranking_pagina_1</span> <span class='op'>&lt;-</span> <span class='va'>resultado</span> <span class='op'>%&gt;%</span> 
  <span class='co'># pegando o conteudo do GET</span>
  <span class='fu'><a href='https://httr.r-lib.org/reference/content.html'>content</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># pegando o xpath que contém a tabela</span>
  <span class='fu'><a href='http://xml2.r-lib.org/reference/xml_find_all.html'>xml_find_all</a></span><span class='op'>(</span>xpath <span class='op'>=</span> <span class='st'>'//table'</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># parseando o codigo html para o rvest</span>
  <span class='fu'>rvest</span><span class='fu'>::</span><span class='fu'><a href='https://rvest.tidyverse.org/reference/html_table.html'>html_table</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># extraindo o primeiro elemento da lista</span>
  <span class='fu'>pluck</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>
<span class='va'>ranking_pagina_1</span>
</code></pre>
</div>
<pre><code># A tibble: 100 × 7
   `Board Game Rank` `Thumbnail imag… Title `Geek Rating` `Avg Rating`
               &lt;int&gt; &lt;lgl&gt;            &lt;chr&gt;         &lt;dbl&gt;        &lt;dbl&gt;
 1                 1 NA               &quot;Glo…          8.53         8.76
 2                 2 NA               &quot;Pan…          8.45         8.6 
 3                 3 NA               &quot;Bra…          8.41         8.67
 4                 4 NA               &quot;Ter…          8.28         8.42
 5                 5 NA               &quot;Glo…          8.26         8.74
 6                 6 NA               &quot;Twi…          8.26         8.69
 7                 7 NA               &quot;Gai…          8.18         8.49
 8                 8 NA               &quot;Sta…          8.17         8.43
 9                 9 NA               &quot;Thr…          8.16         8.4 
10                10 NA               &quot;Gre…          8.13         8.3 
# … with 90 more rows, and 2 more variables: Num Voters &lt;int&gt;,
#   Shop &lt;chr&gt;</code></pre>
</div>
<p>Beleza! Já temos quase tudo o que queríamos! Só faltou uma coisinha: onde estão os links com o <em>id</em> numérico único de cada título? Se voltarmos ao código HTML, essa informação parece não estar presente na tabela…mas calma aí, vamos dar um passo para trás e tentar entender onde estaria essa informação. Se abrirmos a página de alguns jogos e olharmos as <em>urls</em> podemos ver que existe um padrãozinho: a <em>url</em> de cada título usa um sufixo na forma <code>boardgame/&lt;sequência numérica&gt;/&lt;nome do jogo&gt;</code>.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>knitr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/knitr/man/include_graphics.html'>include_graphics</a></span><span class='op'>(</span>path <span class='op'>=</span> <span class='st'>'images/parsear_1.jpg'</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="images/parsear_1.jpg" width="1680" style="display: block; margin: auto;" /></p>
</div>
<p>Essa sequência numérica ali na <em>url</em> para o título na página nada mais é do que o <em>id</em> que estamos buscando. Se procurarmos este padrão dentro do HTML da página do ranking do BGG, podemos ver que ele está dentro do XPath da tabela que já havíamos rapasdo, mas dentro de uma outra <em>tag</em>. Dado que ainda temos o resultado do nosso <em>request</em>, podemos então utilizar o XPath para pegar todos os <em>links</em> na tabela HTML que possuem a classe <em>primary</em>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>resultado</span> <span class='op'>%&gt;%</span> 
  <span class='co'># pegando o conteudo do GET</span>
  <span class='fu'><a href='https://httr.r-lib.org/reference/content.html'>content</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># pegando todos as tags de link na classe primary</span>
  <span class='fu'><a href='http://xml2.r-lib.org/reference/xml_find_all.html'>xml_find_all</a></span><span class='op'>(</span>xpath <span class='op'>=</span> <span class='st'>'//table//a[@class="primary"]'</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># pegando so os primeiros exemplos</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>{xml_nodeset (6)}
[1] &lt;a href=&quot;/boardgame/174430/gloomhaven&quot; class=&quot;primary&quot;&gt;Gloomhav ...
[2] &lt;a href=&quot;/boardgame/161936/pandemic-legacy-season-1&quot; class=&quot;pri ...
[3] &lt;a href=&quot;/boardgame/224517/brass-birmingham&quot; class=&quot;primary&quot;&gt;Br ...
[4] &lt;a href=&quot;/boardgame/167791/terraforming-mars&quot; class=&quot;primary&quot;&gt;T ...
[5] &lt;a href=&quot;/boardgame/291457/gloomhaven-jaws-lion&quot; class=&quot;primary ...
[6] &lt;a href=&quot;/boardgame/233078/twilight-imperium-fourth-edition&quot; cl ...</code></pre>
</div>
<p>E aí estão os links! Agora é só pegar eles, colocar como uma coluna dentro da tabela que já havíamos parseado e pronto! Os elementos básicos do que buscávamos estão em seus devidos lugares. Agora é tentar repetir e escalar.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># colocando os links em uma lista</span>
<span class='va'>links</span> <span class='op'>&lt;-</span> <span class='va'>resultado</span> <span class='op'>%&gt;%</span> 
  <span class='co'># pegando o conteudo do GET</span>
  <span class='fu'><a href='https://httr.r-lib.org/reference/content.html'>content</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># pegando todos as tags de link na classe primary</span>
  <span class='fu'><a href='http://xml2.r-lib.org/reference/xml_find_all.html'>xml_find_all</a></span><span class='op'>(</span>xpath <span class='op'>=</span> <span class='st'>'//table//a[@class="primary"]'</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># pegando o atributo href</span>
  <span class='fu'><a href='http://xml2.r-lib.org/reference/xml_attr.html'>xml_attr</a></span><span class='op'>(</span>attr <span class='op'>=</span> <span class='st'>'href'</span><span class='op'>)</span>

<span class='co'># colocando os links na tabela</span>
<span class='va'>ranking_pagina_1</span> <span class='op'>&lt;-</span> <span class='va'>ranking_pagina_1</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>
    <span class='co'># colocando os links em uma coluna</span>
    link <span class='op'>=</span> <span class='va'>links</span>
  <span class='op'>)</span>
<span class='va'>ranking_pagina_1</span>
</code></pre>
</div>
<pre><code># A tibble: 100 × 8
   `Board Game Rank` `Thumbnail imag… Title `Geek Rating` `Avg Rating`
               &lt;int&gt; &lt;lgl&gt;            &lt;chr&gt;         &lt;dbl&gt;        &lt;dbl&gt;
 1                 1 NA               &quot;Glo…          8.53         8.76
 2                 2 NA               &quot;Pan…          8.45         8.6 
 3                 3 NA               &quot;Bra…          8.41         8.67
 4                 4 NA               &quot;Ter…          8.28         8.42
 5                 5 NA               &quot;Glo…          8.26         8.74
 6                 6 NA               &quot;Twi…          8.26         8.69
 7                 7 NA               &quot;Gai…          8.18         8.49
 8                 8 NA               &quot;Sta…          8.17         8.43
 9                 9 NA               &quot;Thr…          8.16         8.4 
10                10 NA               &quot;Gre…          8.13         8.3 
# … with 90 more rows, and 3 more variables: Num Voters &lt;int&gt;,
#   Shop &lt;chr&gt;, link &lt;chr&gt;</code></pre>
</div>
<h1 id="validar">Validar</h1>
<p>Como já sabemos pegar e parsear uma página do ranking do BGG, a ideia aqui será repetir o processo anterior para uma segunda ou uma enésima página. Para isso, vou consolidar o que fizemos anteriormente em duas funções: uma para fazer o <em>request</em> da página do ranking do BGG (<code>pega_pagina</code>) e uma outra função para parsear o conteúdo de um <em>request</em> para uma <code>tibble</code> (<code>parser_pagina</code>).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># função para fazer o GET</span>
<span class='va'>pega_pagina</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>url_base</span>, <span class='va'>pagina</span>, <span class='va'>save_dir</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'>## junta a base url com o numero da pagina e salva no diretorio alvo</span>
  <span class='va'>resultado_do_get</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://httr.r-lib.org/reference/GET.html'>GET</a></span><span class='op'>(</span>url <span class='op'>=</span> <span class='fu'>str_glue</span><span class='op'>(</span><span class='va'>url_base</span>, <span class='va'>pagina</span><span class='op'>)</span>, 
                          <span class='fu'><a href='https://httr.r-lib.org/reference/write_disk.html'>write_disk</a></span><span class='op'>(</span>path <span class='op'>=</span> <span class='fu'>str_glue</span><span class='op'>(</span><span class='st'>'{save_dir}/page_{pagina}.html'</span><span class='op'>)</span>, 
                                     overwrite <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='op'>)</span>
  <span class='co'># retorna o resultado do GET</span>
  <span class='va'>resultado_do_get</span>
<span class='op'>}</span>

<span class='co'># função para parsear o resultado</span>
<span class='va'>parser_pagina</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>pagina_raspada</span><span class='op'>)</span><span class='op'>{</span>
  <span class='co'># pegando todos os links que estão dentro da tabela </span>
  <span class='va'>links_da_pagina</span> <span class='op'>&lt;-</span> <span class='va'>pagina_raspada</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='http://xml2.r-lib.org/reference/xml_find_all.html'>xml_find_all</a></span><span class='op'>(</span>xpath <span class='op'>=</span> <span class='st'>'//table//a[@class="primary"]'</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='http://xml2.r-lib.org/reference/xml_attr.html'>xml_attr</a></span><span class='op'>(</span>attr <span class='op'>=</span> <span class='st'>'href'</span><span class='op'>)</span>
  
  <span class='co'>## parseando o codigo HTML da tabela para um tibble</span>
  <span class='va'>tabela_da_pagina</span> <span class='op'>&lt;-</span> <span class='va'>pagina_raspada</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='http://xml2.r-lib.org/reference/xml_find_all.html'>xml_find_all</a></span><span class='op'>(</span>xpath <span class='op'>=</span> <span class='st'>'//table'</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>rvest</span><span class='fu'>::</span><span class='fu'><a href='https://rvest.tidyverse.org/reference/html_table.html'>html_table</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>pluck</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>link <span class='op'>=</span> <span class='va'>links</span><span class='op'>)</span>
  
  <span class='co'>## retornando a tabela</span>
  <span class='va'>tabela_da_pagina</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Aplicando estas funções à segunda página do ranking do BGG temos então o Top 101 à 200 na tabela.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## pegando o conteudo da segunda pagina do ranking</span>
<span class='va'>ranking_pagina_2</span> <span class='op'>&lt;-</span> <span class='fu'>pega_pagina</span><span class='op'>(</span>url_base <span class='op'>=</span> <span class='va'>base_url</span>, 
                                pagina <span class='op'>=</span> <span class='fl'>2</span>,
                                save_dir <span class='op'>=</span> <span class='st'>'data/'</span>
<span class='op'>)</span>

<span class='co'>## parseando o resultado do GET</span>
<span class='va'>ranking_pagina_2</span> <span class='op'>&lt;-</span> <span class='fu'>parser_pagina</span><span class='op'>(</span>pagina_raspada <span class='op'>=</span> <span class='fu'><a href='https://httr.r-lib.org/reference/content.html'>content</a></span><span class='op'>(</span><span class='va'>ranking_pagina_2</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>ranking_pagina_2</span>
</code></pre>
</div>
<pre><code># A tibble: 100 × 8
   `Board Game Rank` `Thumbnail imag… Title `Geek Rating` `Avg Rating`
               &lt;int&gt; &lt;lgl&gt;            &lt;chr&gt;         &lt;dbl&gt;        &lt;dbl&gt;
 1               101 NA               &quot;Dec…          7.51         7.8 
 2               102 NA               &quot;Dom…          7.50         7.61
 3               103 NA               &quot;She…          7.50         7.71
 4               104 NA               &quot;Ini…          7.50         7.81
 5               105 NA               &quot;Pan…          7.50         7.6 
 6               106 NA               &quot;Cla…          7.49         7.85
 7               107 NA               &quot;Pan…          7.49         7.92
 8               108 NA               &quot;Cha…          7.49         7.76
 9               109 NA               &quot;Yok…          7.49         7.85
10               110 NA               &quot;For…          7.48         7.98
# … with 90 more rows, and 3 more variables: Num Voters &lt;int&gt;,
#   Shop &lt;chr&gt;, link &lt;chr&gt;</code></pre>
</div>
<h1 id="iterar">Iterar</h1>
<p>O objetivo aqui seria passar uma sequência de páginas de 1 até <code>n</code> e usar as funções <code>pega_pagina</code> e <code>parser_pagina</code> para escalar o processo. Como a idéia é apenas demonstrar, vou raspar apenas as 5 primeiras páginas do ranking, fazendo uma pequena modificação na função que criei para não bombardear o BGG de <em>requests</em> num curto período de tempo. Para isso, vou adicionar um <code>Sys.sleep</code> depois do <code>GET</code>, para que ele espere alguns segundos entre requisições, definindo o tempo de espera entre requisições através de uma distribuição uniforme.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># adicionando um sys.sleep na função</span>
<span class='va'>pega_pagina_com_espera</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>url_base</span>, <span class='va'>pagina</span>, <span class='va'>save_dir</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'>## junta a base url com o numero da pagina e salva no diretorio alvo</span>
  <span class='va'>resultado_do_get</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://httr.r-lib.org/reference/GET.html'>GET</a></span><span class='op'>(</span>url <span class='op'>=</span> <span class='fu'>str_glue</span><span class='op'>(</span><span class='va'>url_base</span>, <span class='va'>pagina</span><span class='op'>)</span>, 
                          <span class='fu'><a href='https://httr.r-lib.org/reference/write_disk.html'>write_disk</a></span><span class='op'>(</span>path <span class='op'>=</span> <span class='fu'>str_glue</span><span class='op'>(</span><span class='st'>'{save_dir}/page_{pagina}.html'</span><span class='op'>)</span>, 
                                     overwrite <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/Sys.sleep.html'>Sys.sleep</a></span><span class='op'>(</span>time <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>1</span>, min <span class='op'>=</span> <span class='fl'>1</span>, max <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
  <span class='co'># retorna o resultado do GET</span>
  <span class='va'>resultado_do_get</span>
<span class='op'>}</span>

<span class='co'>## raspando todas as paginas do ranking</span>
<span class='fu'>walk</span><span class='op'>(</span>.x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span>, .f <span class='op'>=</span> <span class='va'>pega_pagina_com_espera</span>, 
     url_base <span class='op'>=</span> <span class='va'>base_url</span>, save_dir <span class='op'>=</span> <span class='st'>'data/'</span><span class='op'>)</span>

<span class='co'>## listando os arquivos html na pasta data</span>
<span class='va'>paginas_salvas</span> <span class='op'>&lt;-</span> <span class='fu'><a href='http://fs.r-lib.org/reference/dir_ls.html'>dir_ls</a></span><span class='op'>(</span>path <span class='op'>=</span> <span class='st'>'data/'</span><span class='op'>)</span>

<span class='co'>## parseando as paginas na pasta data</span>
<span class='va'>paginas_raspadas</span> <span class='op'>&lt;-</span> <span class='fu'>map</span><span class='op'>(</span>.x <span class='op'>=</span> <span class='va'>paginas_salvas</span>, .f <span class='op'>=</span> <span class='va'>read_html</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>map</span><span class='op'>(</span>.f <span class='op'>=</span> <span class='va'>parser_pagina</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='va'>bind_rows</span>
<span class='va'>paginas_raspadas</span>
</code></pre>
</div>
<pre><code># A tibble: 500 × 8
   `Board Game Rank` `Thumbnail imag… Title `Geek Rating` `Avg Rating`
               &lt;int&gt; &lt;lgl&gt;            &lt;chr&gt;         &lt;dbl&gt;        &lt;dbl&gt;
 1                 1 NA               &quot;Glo…          8.53         8.76
 2                 2 NA               &quot;Pan…          8.45         8.6 
 3                 3 NA               &quot;Bra…          8.41         8.67
 4                 4 NA               &quot;Ter…          8.28         8.42
 5                 5 NA               &quot;Glo…          8.26         8.74
 6                 6 NA               &quot;Twi…          8.26         8.69
 7                 7 NA               &quot;Gai…          8.18         8.49
 8                 8 NA               &quot;Sta…          8.17         8.43
 9                 9 NA               &quot;Thr…          8.16         8.4 
10                10 NA               &quot;Gre…          8.13         8.3 
# … with 490 more rows, and 3 more variables: Num Voters &lt;int&gt;,
#   Shop &lt;chr&gt;, link &lt;chr&gt;</code></pre>
</div>
<h1 id="faxinar-não-incluído-mas-importante">Faxinar (não incluído, mas importante)</h1>
<p>Apesar desta etapa não estar apresentada de forma explícita na figura da Curso-R, acredito que seja importante e legal a gente dar um jeitinho nos dados antes de terminar. O código abaixo dá conta disso, fazendo algumas coisas: (a) ajeitando o nome das colunas, (b) removendo colunas que não vou precisar, (c) extraindo e organizando o nome do jogo, o ano e sua descrição curta a partir da coluna <code>Title</code>, (d) extraindo o <em>id</em> numérico único de cada jogo e (e) renomeando algumas colunas para algo um pouco mais intuitivo. Com isso, a tabela fica bem arrumada e mais apresentável.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>paginas_faxinadas</span> <span class='op'>&lt;-</span> <span class='va'>paginas_raspadas</span> <span class='op'>%&gt;%</span> 
  <span class='co'># usando o janitor para ajustar o nome das colunas</span>
  <span class='fu'>janitor</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/janitor/man/clean_names.html'>clean_names</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># pegando somente algumas das colunas</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>thumbnail_image</span>, <span class='op'>-</span><span class='va'>shop</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># ajustando a string do titulo</span>
  <span class='fu'>mutate</span><span class='op'>(</span>
    <span class='co'># removendo o excesso de espaços da string do title</span>
    title <span class='op'>=</span> <span class='fu'>str_squish</span><span class='op'>(</span>string <span class='op'>=</span> <span class='va'>title</span><span class='op'>)</span>,
    <span class='co'># pegando a apenas o titulo do jogo</span>
    titulo    <span class='op'>=</span> <span class='fu'>str_extract</span><span class='op'>(</span>string <span class='op'>=</span> <span class='va'>title</span>, 
                            pattern <span class='op'>=</span> <span class='st'>'(.*)(?=\\s\\(\\-?[0-9]{1,4}\\))'</span><span class='op'>)</span>,
    <span class='co'># ano de lançamento</span>
    ano       <span class='op'>=</span> <span class='fu'>str_extract</span><span class='op'>(</span>string <span class='op'>=</span> <span class='va'>title</span>, 
                            pattern <span class='op'>=</span> <span class='st'>'(?&lt;=\\()(\\-?[0-9]{1,4})(?=\\))'</span><span class='op'>)</span>,
    <span class='co'># descrição</span>
    descricao <span class='op'>=</span> <span class='fu'>str_extract</span><span class='op'>(</span>string <span class='op'>=</span> <span class='va'>title</span>, 
                            pattern <span class='op'>=</span> <span class='st'>'(?&lt;=\\s\\(\\-?[0-9]{1,4}\\)\\s)(.*)'</span><span class='op'>)</span>,
    <span class='co'># extraindo o id do jogo</span>
    id        <span class='op'>=</span> <span class='fu'>str_extract</span><span class='op'>(</span>string <span class='op'>=</span> <span class='va'>link</span>, 
                            pattern <span class='op'>=</span> <span class='st'>'(?&lt;=boardgame\\/)([0-9]+)(?=\\/)'</span><span class='op'>)</span>,
    <span class='co'># parseando o ano para numerico</span>
    ano       <span class='op'>=</span> <span class='fu'>parse_number</span><span class='op'>(</span><span class='va'>ano</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># organizando a tabela</span>
  <span class='fu'>relocate</span><span class='op'>(</span>
    <span class='va'>id</span>, <span class='va'>titulo</span>, <span class='va'>ano</span>, .after <span class='op'>=</span> <span class='va'>board_game_rank</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>relocate</span><span class='op'>(</span>
    <span class='va'>title</span>, .after <span class='op'>=</span> <span class='va'>num_voters</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># renomeando as colunas</span>
  <span class='fu'>rename</span><span class='op'>(</span>
    rank <span class='op'>=</span> <span class='va'>board_game_rank</span>, nota_bgg <span class='op'>=</span> <span class='va'>geek_rating</span>, 
    nota_usuarios <span class='op'>=</span> <span class='va'>avg_rating</span>, votos <span class='op'>=</span> <span class='va'>num_voters</span>
  <span class='op'>)</span>
<span class='va'>paginas_faxinadas</span>
</code></pre>
</div>
<pre><code># A tibble: 500 × 10
    rank id     titulo    ano nota_bgg nota_usuarios votos title link 
   &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
 1     1 174430 Gloomh…  2017     8.53          8.76 45618 Gloo… /boa…
 2     2 161936 Pandem…  2015     8.45          8.6  43686 Pand… /boa…
 3     3 224517 Brass:…  2018     8.41          8.67 23075 Bras… /boa…
 4     4 167791 Terraf…  2016     8.28          8.42 70417 Terr… /boa…
 5     5 291457 Gloomh…  2020     8.26          8.74 13096 Gloo… /boa…
 6     6 233078 Twilig…  2017     8.26          8.69 15000 Twil… /boa…
 7     7 220308 Gaia P…  2017     8.18          8.49 17926 Gaia… /boa…
 8     8 187645 Star W…  2016     8.17          8.43 24605 Star… /boa…
 9     9 182028 Throug…  2015     8.16          8.4  24635 Thro… /boa…
10    10 193738 Great …  2016     8.13          8.3  31595 Grea… /boa…
# … with 490 more rows, and 1 more variable: descricao &lt;chr&gt;</code></pre>
</div>
<p>E só para fechar: uma figura sobre os dados que raspamos né! Vamos tentar visualizar qual a relação entre a nota do BGG, a nota média dada pelos usuários e quantidade de votos recebidos por cada jogo. A figura abaixo mostra que as notas dadas pelos usuários parecem ser maiores do que as notas do ranking final do BGG - fato que ocorre pois o BGG usa uma média bayesiana para montar o seu ranking. Além disso, podemos ver que parece existir uma tendência aos jogos que recebem mais votos também terem maiores notas no ranking do BGG. Por outro lado, parece que os jogos mais votados são aqueles com menores notas dadas pelos usuários. Curioso, não?</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>paginas_faxinadas</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggforce.data-imaginist.com/reference/geom_autopoint.html'>geom_autopoint</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.7</span>, shape <span class='op'>=</span> <span class='fl'>21</span>, fill <span class='op'>=</span> <span class='st'>'deepskyblue3'</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggforce.data-imaginist.com/reference/geom_autohistogram.html'>geom_autodensity</a></span><span class='op'>(</span>mapping <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>.panel_x</span>, y <span class='op'>=</span> <span class='va'>.panel_y</span><span class='op'>)</span>, 
                   fill <span class='op'>=</span> <span class='st'>'deepskyblue3'</span>, color <span class='op'>=</span> <span class='st'>'black'</span>, alpha <span class='op'>=</span> <span class='fl'>0.7</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggforce.data-imaginist.com/reference/facet_matrix.html'>facet_matrix</a></span><span class='op'>(</span>rows <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>nota_bgg</span><span class='op'>:</span><span class='va'>votos</span><span class='op'>)</span>, layer.diag <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="raspando-a-pagina-do-ranking-da-boardgamegeek_files/figure-html5/figura_exploratoria-1.png" width="1950" data-distill-preview=1 style="display: block; margin: auto;" /></p>
</div>
<h1 id="conclusões">Conclusões</h1>
<p>Esse foi o passo-a-passo que eu usei para pegar os jogos que estão na página do ranking do BoardGameGeek (BGG) e o <em>id</em> numérico deles. Precisei fazer essa raspagem pois a API XML do BGG funciona melhor através da utilização deste <em>id</em>, e não encontrei outra forma de pegar essa informação em nenhum outro lugar no site ou na API. Existem melhorias que poderiam ser feitas na função e no <em>pipeline</em> de raspagem aqui, tais como adicionar uns <code>safely</code> ou <code>insistently</code> no <code>GET</code> em caso de falhas ou coisas do gênero. Outra melhoria seria também automatizar a identificação da última página que precisa ser raspada. Para este último, deixo até a dica aqui de como pegar o valor: ele está numa <em>tag</em> <em>div</em> no início e no fim do HTML, de forma que basta pegarmos a sua primeira ocorrência para saber o valor máximo da quantidade de páginas; então, é só colocá-lo em um objeto e chamar ele na hora de usar o <code>walk</code> ali em cima.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ultima_pagina</span> <span class='op'>&lt;-</span> <span class='va'>resultado</span> <span class='op'>%&gt;%</span> 
  <span class='co'># pegando o conteudo do GET</span>
  <span class='fu'><a href='https://httr.r-lib.org/reference/content.html'>content</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># pegando a tag que contem o limite de paginas</span>
  <span class='fu'><a href='http://xml2.r-lib.org/reference/xml_find_all.html'>xml_find_first</a></span><span class='op'>(</span>xpath <span class='op'>=</span> <span class='st'>'//div//*[@title="last page"]'</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># limpando a tag</span>
  <span class='fu'><a href='http://xml2.r-lib.org/reference/xml_text.html'>xml_text</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># passando ela para um numero</span>
  <span class='fu'>parse_number</span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>ultima_pagina</span>
</code></pre>
</div>
<pre><code>[1] 1304</code></pre>
</div>
<p>Dúvidas ou sugestões? É só me procurar que a gente conversa!</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-Lente2018" class="csl-entry" role="doc-biblioentry">
Lente, Caio. 2018. <span>“O Fluxo Do Web Scraping.”</span> <em>Blog Da Curso-R</em>. <a href="https://blog.curso-r.com/posts/2018-02-18-fluxo-scraping/">https://blog.curso-r.com/posts/2018-02-18-fluxo-scraping/</a>.
</div>
</div>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>Essa API ainda está em desenvolvimento, e devo escrever sobre o consumo de informações através dela em outro post<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="references">References</h3>
<div id="references-listing"></div>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
